import java.util.ArrayList;
import java.util.LinkedList;
import org.jline.terminal.Terminal;
import org.jline.terminal.TerminalBuilder;

class WordNode{

    public String word;
    public int spaces;


    public WordNode(String string , int integer){
	word=string;
	spaces=integer;
    }

    public void changeWord(String newWord){
        word=newWord;
    }
    public void changeSpaces(int newSpaces){
        spaces=newSpaces;
    }
    
    public String getWord(){
        return word;
    }

    public int getSpaces(){
        return spaces;
    }
}



public class editor{

    
    //declar array of links to strings
    static ArrayList<ArrayList<WordNode>> text = new ArrayList<>();

    //line
    static int x=0;
    //
    static int real_y=0;
    //word
    static int y=0;
    //leter of word
    static int z=0;

    
    public static void find_real_y(){
	real_y=z;
	for(int word_index=0;word_index<y;word_index++){
	    real_y+=text.get(x).get(word_index).getWord().length();
	    real_y+=text.get(x).get(word_index).getSpaces();
	}
     
    }

    public static void colibrateZY(){
        int line_length=0;
	boolean breaked_loop=false;
	for(int word_index=0;word_index<text.get(x).size();word_index++){
	    int word_length=text.get(x).get(word_index).getWord().length();
	    word_length+=text.get(x).get(word_index).getSpaces();
	    if(line_length+word_length>real_y){
	        y=word_index;
		z=real_y-line_length;
		breaked_loop=true;
		break;
	    }
	    else{
                line_length+=word_length;
	    }
	}
	if (!breaked_loop){
	    y=text.get(x).size()-1;
     	    z=text.get(x).get(y).getWord().length()-1+text.get(x).get(y).getSpaces();
	}

    }

    public static void movement_logic_DAWN(){
        if(x<text.size()-1){
	    x++;
	    colibrateZY();
	}
	else{
	    x=0;
	    colibrateZY();
	}
    }

    public static void movement_logic_UP(){
       if(x>0){
           x--;
	   colibrateZY();
       }
       else{
	   x=text.size()-1;
	   colibrateZY();
       }
    }

    public static void movement_logic_LEFT(){
           if(z>0){
	       z--;
	       real_y--;
	   }
	   else{
	       if(y==0){
	           movement_logic_UP();
                   y=text.get(x).size()-1;
	       }
	       else{ 
	           y--;
	           real_y--;
	       }
	       z=text.get(x).get(y).getWord().length()-1+text.get(x).get(y).getSpaces();
	       find_real_y();
	   }
    }

    public static void movement_logic_RIGHT(){
           if(z<text.get(x).get(y).getWord().length()-1+text.get(x).get(y).getSpaces()){
	       z++;
	       real_y++;
	   }
	   else{
	       if(y==text.get(x).size()-1){ 
		   movement_logic_DAWN();
		   y=0;
		   
	       }
	       else{ 
	           y++;
		   real_y++;
	       }
	       z=0;
	       find_real_y();
	   }
    }

    public static void editor_loop(Terminal terminal)throws Exception{
        boolean change = true;
	while(true){
	    	    
            if(change){
                change=false;
		print();
	    }
            
            int input= terminal.reader().read();


	    if(input==27){
	        int secondInput = terminal.reader().read();
		if(secondInput==91){
		    int thirdInput = terminal.reader().read();
                    if(thirdInput == 65){ 	
			movement_logic_UP();
			change=true;
		    }
		    else if(thirdInput ==66){ 
		        movement_logic_DAWN();	
			change=true;
		    }
		    else if(thirdInput ==67){ 
			movement_logic_RIGHT();
			change=true;
		    }
		    else if(thirdInput ==68){ 
			movement_logic_LEFT();
			change=true;
		    }
		     System.out.println("kay: " + input +" and " + secondInput + " and " + thirdInput + " ("+ (char)input + ")");
		}
		else
		    break;
	    }
	    else{
                //char c = (char) input;
                insert(input);
		change=true;
	    }
	     //System.out.println("kay: " + input + " (" + (char)input + ")");
             //break;
        }
    }

    public static void init(String file_name[]){
    
        //linked list test
	ArrayList<WordNode> line1 = new ArrayList<>();
        WordNode word= new WordNode("first",0);
	line1.add(word);
        word=new WordNode("second",4);
	line1.add(word);
        text.add(line1);
        ArrayList<WordNode> line2 = new ArrayList<>();
        word=new WordNode("L2_first",0);
	line2.add(word);
        word=new WordNode("L2_second",4);
	line2.add(word);
        text.add(line2);
	ArrayList<WordNode> line3 = new ArrayList<>();
        word=new WordNode("L3_first",0);
	line3.add(word);
        word=new WordNode("L3_second",4);
	line3.add(word);
        text.add(line3);	//open file
        //copy into array of links to string
        //close file
    }
    

    public static void insert(int input){
	if(input==127){
            if(z>0 && z<=text.get(x).get(y).spaces){
	        if(text.get(x).get(y).spaces>1){
		    text.get(x).get(y).spaces--;
	            z--;
		    real_y--;
	        }
		else if (y!=0){
		    text.get(x).get(y-1).word+= text.get(x).get(y).word;
		    text.get(x).remove(y);
                    real_y--;
		    colibrateZY();
         
		}

	    }
	else{
	     if(z==0 && y!=0){
                  text.get(x).get(y-1).word =  text.get(x).get(y-1).word.substring(0,  text.get(x).get(y-1).word.length() - 1);
	     }
	     else if(z!=0){
	     text.get(x).get(y).word= text.get(x).get(y).word.substring(0, z-text.get(x).get(y).spaces-1) + text.get(x).get(y).word.substring(z-text.get(x).get(y).spaces );
	     real_y--;
	     colibrateZY();
	     }

	}    
	    
	

	}
	else if((char) input==' '){
	    if(z<=text.get(x).get(y).spaces){
                text.get(x).get(y).spaces++;
	        z++;
	        real_y++;
	    }
	    else{    
                text.get(x).add(y+1,new WordNode("",1));
		//WordNode word= new Wordnode("",1);
		int cut_size=0;
		for(int i=z+1;i<=text.get(x).get(y).word.length()+text.get(x).get(y).spaces;i++)
		{
		    text.get(x).get(y+1).word+=text.get(x).get(y).word.charAt(i-text.get(x).get(y).spaces-1);
		    cut_size++;
	        }
		text.get(x).get(y).word = text.get(x).get(y).word.substring(0, text.get(x).get(y).word.length() - cut_size);
		real_y++;
		y++;
		z=1;
                //colibrateZY();
	    }
	}
	else{
	
	    if(z>0 && z<text.get(x).get(y).spaces){
                text.get(x).get(y).spaces-=z;
		text.get(x).add(y,new WordNode(String.valueOf((char) input),z));
		real_y++;
		y++;
		z=0;
		//colibrateZY();
	    }
	    else{
                if(z==0 && y!=0){
                    text.get(x).get(y-1).word+=(char) input;
		    real_y++;
                   
		}
		else if (z!=0) {
		    text.get(x).get(y).word =  text.get(x).get(y).word.substring(0, z-text.get(x).get(y).spaces) + (char) input +  text.get(x).get(y).word.substring(z-text.get(x).get(y).spaces);
                    z++;
		    real_y++;
		}
		else{
                    text.get(x).get(y).word = (char)input + text.get(x).get(y).word;
		    //z++;
		    real_y++;
		    colibrateZY();
		}
	    }
	

	}

    }
    public static void print(){
	System.out.print("\033[H\033[2J");
        System.out.flush();


	System.out.println("x "+ x +" real_Y "+real_y +" y "+ y + " z " + z);
	for(int line_index=0; line_index<text.size();line_index++){
            int word_index=0;
	    for(WordNode word : text.get(line_index)){
                String spaces="";
		for(int i=0;i<word.getSpaces();i++)
			spaces+=" ";
                    if(line_index==x && word_index==y && z<word.getSpaces())
  	                System.out.print(spaces.substring(0, z) +"\u001b[43m" + spaces.charAt(z) +"\u001b[0m" + spaces.substring(z+ 1));
		    else
		        System.out.print(spaces);
                if(line_index==x && word_index==y && z>=word.getSpaces())
		    System.out.print(word.getWord().substring(0, z-word.getSpaces()) +"\u001b[43m" + word.getWord().charAt(z-word.getSpaces()) +"\u001b[0m" + word.getWord().substring(z-word.getSpaces()+ 1));
		else
		    System.out.print(word.getWord());
	        word_index++;
	    }

	    System.out.println();
	}
        //print array of links to string
    }  

    public static void main (String args[])throws Exception{

        /*test
        java.io.File file= new java.io.File("test.txt");
	System.out.println("dose exist? "+file.exists());
        */
        init(args);
       // print();
        Terminal terminal = TerminalBuilder.terminal();
        terminal.enterRawMode();
	editor_loop(terminal);
	//reed args file
        //copy into memmory
        //editor_loop
        //exit 
    }
C
